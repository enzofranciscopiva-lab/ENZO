-- Tabela de Clientes
CREATE TABLE Cliente (
    id_cliente SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf VARCHAR(14) UNIQUE NOT NULL,
    email VARCHAR(100),
    telefone VARCHAR(20),
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Categorias de Produtos
CREATE TABLE Categoria (
    id_categoria SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT
);

-- Tabela de Produtos
CREATE TABLE Produto (
    id_produto SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT,
    preco NUMERIC(10,2) NOT NULL CHECK (preco >= 0),
    estoque INT NOT NULL DEFAULT 0 CHECK (estoque >= 0),
    id_categoria INT REFERENCES Categoria(id_categoria) 
        ON DELETE SET NULL 
        ON UPDATE CASCADE
);

-- Tabela de Pedidos
CREATE TABLE Pedido (
    id_pedido SERIAL PRIMARY KEY,
    id_cliente INT REFERENCES Cliente(id_cliente) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    data_pedido TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    valor_total NUMERIC(10,2) NOT NULL CHECK (valor_total >= 0),
    status VARCHAR(50) NOT NULL CHECK (status IN ('Pendente','Pago','Cancelado','Enviado','Finalizado'))
);

-- Tabela de Itens do Pedido
CREATE TABLE Item_Pedido (
    id_item SERIAL PRIMARY KEY,
    id_pedido INT REFERENCES Pedido(id_pedido) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    id_produto INT REFERENCES Produto(id_produto) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    quantidade INT NOT NULL CHECK (quantidade > 0),
    preco_unitario NUMERIC(10,2) NOT NULL CHECK (preco_unitario >= 0)
);

-- Tabela de Fornecedores
CREATE TABLE Fornecedor (
    id_fornecedor SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cnpj VARCHAR(18) UNIQUE NOT NULL,
    telefone VARCHAR(20),
    email VARCHAR(100)
);

-- Relacionamento Produto x Fornecedor (N:N)
CREATE TABLE Produto_Fornecedor (
    id_produto INT REFERENCES Produto(id_produto) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    id_fornecedor INT REFERENCES Fornecedor(id_fornecedor) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE,
    preco_compra NUMERIC(10,2) NOT NULL CHECK (preco_compra >= 0),
    PRIMARY KEY (id_produto, id_fornecedor)
);
